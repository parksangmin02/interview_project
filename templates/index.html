<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>AI 면접 시스템</title>
  <style>
    body { font-family: Arial; margin: 40px; }
    input, textarea, button { width: 100%; padding: 10px; margin-top: 10px; }
    #output, #evaluation { background: #f7f7f7; padding: 15px; margin-top: 20px; white-space: pre-wrap; }
    .hidden { display: none; }
    #file_status { color: green; margin-top: 5px; }
  </style>
</head>
<body>

  <h2>AI 면접 질문 생성기</h2>

  <!-- 지원 직무 -->
  <label>지원 직무</label>
  <input id="job_position" placeholder="예: 백엔드 개발자">

  <!-- 자기소개서 텍스트 입력 -->
  <label style="margin-top:20px;">자기소개서 내용 입력 (선택)</label>
  <textarea id="self_intro" rows="5" placeholder="자기소개서를 직접 입력하거나 아래에서 파일 업로드를 선택하세요."></textarea>

  <!-- 파일 업로드 -->
  <label style="margin-top:10px;">자기소개서 파일 업로드 (.txt .pdf .docx)</label>
  <input type="file" id="resume_file" accept=".txt,.pdf,.docx" onchange="updateFileStatus()">
  <div id="file_status"></div>

  <!-- 질문 생성 버튼 -->
  <button onclick="generateQuestion()">질문 생성</button>

  <!-- 생성된 질문 출력 -->
  <div id="output"></div>

  <!-- 답변 입력 섹션 (처음에는 숨김) -->
  <div id="answer_section" class="hidden">
    <hr>
    <h3>질문에 대한 답변 입력</h3>
    <textarea id="user_answer" rows="5" placeholder="AI가 제시한 질문에 대한 답변을 입력하세요."></textarea>
    <button onclick="evaluateAnswer()">답변 평가 요청</button>

    <div id="evaluation"></div>
  </div>


<script>
  // 파일 업로드 상태 표시
  function updateFileStatus() {
    const fileInput = document.getElementById("resume_file");
    const status = document.getElementById("file_status");

    if (fileInput.files.length > 0) {
      status.textContent = "선택된 파일: " + fileInput.files[0].name;
    } else {
      status.textContent = "";
    }
  }

  // 질문 생성 요청
  async function generateQuestion() {
    const job = document.getElementById('job_position').value.trim();
    const intro = document.getElementById('self_intro').value.trim();
    const file = document.getElementById('resume_file').files[0];

    if (!job) {
      alert("직무를 입력해야 합니다.");
      return;
    }

    if (!intro && !file) {
      alert("자기소개서를 텍스트 또는 파일로 입력해야 합니다.");
      return;
    }

    const formData = new FormData();
    formData.append("job_position", job);
    formData.append("self_intro", intro);
    if (file) formData.append("resume_file", file);

    document.getElementById("output").innerText = "질문 생성 중...";

    const res = await fetch("/generate_question", { method: "POST", body: formData });
    const data = await res.json();

    document.getElementById("output").innerText =
      data.question || data.raw || "질문 생성 실패";

    document.getElementById("answer_section").classList.remove("hidden");
  }

  // 답변 평가 요청
  async function evaluateAnswer() {
    const answer = document.getElementById('user_answer').value.trim();

    if (!answer) {
      alert("답변을 입력해주세요.");
      return;
    }

    document.getElementById("evaluation").innerText = "평가 중...";

    const res = await fetch("/evaluate_answer", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ answer: answer })
    });

    const data = await res.json();

    document.getElementById("evaluation").innerText =
      `강점:\n${data.strengths}\n\n단점:\n${data.weaknesses}`;
  }
</script>

</body>
</html>